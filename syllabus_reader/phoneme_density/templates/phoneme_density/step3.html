{% extends 'syllabus/base.html' %}
{% load static %}

{% block title %}Step 3: Rule Application - {{ ai_game.title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'phoneme_density/css/steps.css' %}">
<style>
    .text-analysis-panel {
        background-color: #ffffff;
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
        padding: 1.5rem;
    }
    
    .provider-text {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
        padding: 1rem;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        line-height: 1.4;
        resize: none;
        width: 100%;
        min-height: 120px;
    }
    
    .text-counter {
        font-size: 0.8rem;
        color: #6c757d;
        text-align: right;
        margin-top: 0.25rem;
    }
    
    .instruction-content {
        font-size: 1rem;
        line-height: 1.6;
    }
    
    .step-header {
        background: linear-gradient(135deg, #007bff, #0056b3);
        color: white;
        padding: 1rem;
        border-radius: 0.375rem;
        margin-bottom: 1.5rem;
    }
    
    .matchup-info {
        background: linear-gradient(135deg, #28a745, #1e7e34);
        color: white;
        padding: 0.75rem 1rem;
        border-radius: 0.375rem;
        margin-bottom: 1rem;
        font-size: 0.9rem;
    }
    
    .pdf-button {
        background: linear-gradient(135deg, #dc3545, #c82333);
        border: none;
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 0.375rem;
        font-weight: 500;
        transition: all 0.3s ease;
    }
    
    .pdf-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3);
        color: white;
    }

    .offcanvas-header {
        background: linear-gradient(135deg, #007bff, #0056b3);
        color: white;
    }
    
    .offcanvas-header .btn-close {
        filter: invert(1);
    }

    /* Bold formatting for letter R - with high specificity */
    .textarea-like .bold-r,
    .bold-r {
        font-weight: bold !important;
    }
    
    /* Textarea-like styling for divs */
    .textarea-like {
        display: block;
        width: 100%;
        padding: 0.375rem 0.75rem;
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        color: #212529;
        background-color: #fff;
        background-image: none;
        border: 1px solid #ced4da;
        border-radius: 0.375rem;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        resize: vertical;
        overflow-y: auto;
        white-space: pre-wrap;
        word-wrap: break-word;
    }
    
    .textarea-like:focus {
        color: #212529;
        background-color: #fff;
        border-color: #86b7fe;
        outline: 0;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }

    @media print {
        .no-print {
            display: none !important;
        }
        
        .print-only {
            display: block !important;
        }
        
        .provider-text {
            break-inside: avoid;
            margin-bottom: 1rem;
        }
        
        .step-header {
            break-inside: avoid;
        }
    }
    
    .print-only {
        display: none;
    }
</style>
{% endblock %}

{% block content %}
<!-- Instructions Offcanvas -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="instructionsOffcanvas" aria-labelledby="instructionsOffcanvasLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="instructionsOffcanvasLabel">
            <i class="fas fa-book-open me-2"></i>Instructions
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        {% if instructions %}
            {% for instruction in instructions %}
                <div class="instruction-step mb-4">
                    <h6 class="text-primary fw-bold">{{ instruction.title }}</h6>
                    <div class="instruction-content">
                        {{ instruction.content|linebreaks }}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="text-muted">
                <p>No specific instructions available for this step.</p>
                <p>Follow the general game instructions and analyze the provided texts.</p>
            </div>
        {% endif %}
    </div>
</div>

<div class="container-fluid">
    <!-- Simple Instructions Button - Left Side -->
    <div style="position: fixed; top: 50%; left: 0; transform: translateY(-50%); z-index: 99999;">
        <button class="btn btn-primary" 
                type="button" 
                data-bs-toggle="offcanvas" 
                data-bs-target="#instructionsOffcanvas" 
                style="border-radius: 0 10px 10px 0; border-left: none; padding: 20px 10px; writing-mode: vertical-rl; text-orientation: mixed; font-size: 11px; font-weight: bold; min-height: 120px;">
            Instructions
        </button>
    </div>

    <!-- Main Content Card -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <!-- Card Header with Title, Matchup Info, Progress, and PDF Button -->
                <div class="card-header bg-primary text-white">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h1 class="h4 mb-1">
                                <i class="fas fa-gavel me-2"></i>Step 3: Rule Application
                            </h1>
                            <div class="d-flex align-items-center gap-3">
                                <span><strong>{{ team1.name }}</strong> vs <strong>{{ team2.name }}</strong></span>
                                <span class="badge bg-light text-dark">Step 3 of {{ total_steps }}</span>
                            </div>
                        </div>
                        <div class="col-md-6 text-md-end">
                            <div class="d-flex align-items-center justify-content-md-end gap-2 mt-2 mt-md-0">
                                <!-- Progress Tracker -->
                                {% if is_teacher %}
                                    <div class="me-3">
                                        {% if can_complete_step %}
                                            <span class="badge bg-warning">In Progress</span>
                                            <form method="post" action="{% url 'phoneme_density:complete_matchup_step' matchup_id=matchup.id step_number=3 %}" class="d-inline ms-2">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-success btn-sm">
                                                    <i class="fas fa-check me-1"></i>Complete
                                                </button>
                                            </form>
                                        {% else %}
                                            <span class="badge bg-success">Completed</span>
                                        {% endif %}
                                    </div>
                                {% endif %}
                                
                                {% if is_teacher %}
                                    <small class="text-light opacity-75">ID: {{ matchup.id }}</small>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Card Body with Text Areas -->
                <div class="card-body">
                    <div class="row">
                        <!-- Text Area 1 - HIGHLIGHTED WITH R BOLD -->
                        <div class="col-md-6 mb-4">
                            <label class="form-label fw-bold">
                                <i class="fas fa-file-text me-2"></i>Text 1
                            </label>
                            <div class="textarea-like" 
                                 style="background-color: #d4edda; border: 2px solid #c3e6cb; height: 200px;"><span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">R</span>osema<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>y a<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span><span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>anged a <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>a<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>e ga<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>den tou<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>, whe<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>e visito<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>s could explo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>e vib<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ant flowe<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>s g<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>owing nea<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ive<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>s and <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ustic te<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span><span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>aces. The ai<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> ca<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span><span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ied c<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>isp a<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>omas of he<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>bs, encou<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>aging eve<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>yone to b<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>eathe deeply. A<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ound eve<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>y co<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ne<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>, int<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>icate pathways cu<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ved g<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>acefully, <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>evealing se<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ene <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>et<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>eats and o<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>cha<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>d <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ows. Child<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>en we<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>e lea<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ning about <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>a<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>e bi<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ds <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>esiding in t<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ees, while a<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>tists p<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>acticed d<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>awing <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ema<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>kable landscapes. As the sun lowe<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ed, cu<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ious guests enjoyed sto<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ies of local t<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>aditions and folklo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>e. <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">R</span>osema<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>y's <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ema<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>kable effo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ts c<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>eated a t<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>easu<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ed space fo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>elaxation and discove<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>y, che<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ished by all.</div>
                        </div>
                        
                        <!-- Text Area 2 - NORMAL WITH R BOLD -->
                        <div class="col-md-6 mb-4">
                            <label class="form-label fw-bold">
                                <i class="fas fa-chart-bar me-2"></i>Text 2
                            </label>
                            <div class="textarea-like" style="height: 200px;">Cooking is a c<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>eative p<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ocess that blends skill, p<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>actice, and patience. Chefs and home cooks alike expe<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>iment with flavo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>s, textu<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>es, and techniques to c<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>aft delicious meals. Selecting f<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>esh ing<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>edients is essential fo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> building taste, whethe<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> p<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>epa<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ing a simple salad o<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> a complex stew. As food simme<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>s o<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> bakes, a<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>omas fill the kitchen, encou<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>aging anticipation. Sha<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ing dishes with f<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>iends o<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> family b<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ings people togethe<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> and c<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>eates lasting memo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ies. Ove<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> time, people develop favo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ite <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ecipes and t<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>aditions, lea<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ning f<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>om each success and failu<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>e. Th<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ough cooking, gene<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ations pass on knowledge, nou<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ishing both body and spi<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>it with eve<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>y meal.</div>
                        </div>
                        
                        <!-- Text Area 3 - NORMAL WITH R BOLD -->
                        <div class="col-md-6 mb-4">
                            <label class="form-label fw-bold">
                                <i class="fas fa-lightbulb me-2"></i>Text 3
                            </label>
                            <div class="textarea-like" style="height: 225px;">The landscape of Savoy, located in the Weste<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>n Alps of F<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ance, is defined by its d<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>amatic mountains, deep valleys, and pictu<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>esque lakes. Snow-capped peaks, such as those in the Savoy Alps and the Vanoise National Pa<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>k, <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ise above g<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>een pastu<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>es and fo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ests. Winding <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ive<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>s, like the Isè<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>e and A<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>c, shape fe<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>tile valleys whe<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>e villages and vineya<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ds th<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ive. The <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>egion is dotted with cha<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ming towns, including Chambé<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>y and Annecy, each su<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span><span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ounded by <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>olling hills o<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> steep alpine slopes. Seasonal changes b<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ing lush meadows in the summe<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> and thick snow in winte<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>, making Savoy a destination fo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> hike<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>s, skie<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>s, and natu<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>e enthusiasts seeking unspoiled scene<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>y</div>
                        </div>
                        
                        <!-- Text Area 4 - HIGHLIGHTED WITH R BOLD -->
                        <div class="col-md-6 mb-4">
                            <label class="form-label fw-bold">
                                <i class="fas fa-notes-medical me-2"></i>Text 4
                            </label>
                            <div class="textarea-like" 
                                 style="background-color: #d4edda; border: 2px solid #c3e6cb; height: 225px;">Th<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>oughout <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>eco<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ded histo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>y, <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ema<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>kable <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ule<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>s and o<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>dina<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>y people alike have t<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ansfo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>med ou<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> wo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ld. <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">R</span>esea<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>che<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>s ca<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>efully explo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>e a<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>chives, sea<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ching fo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>a<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>e <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>eco<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ds that <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>eveal impo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>tant t<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>uths. In va<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ious e<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>as, <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>evolutions <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>eshaped bo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>de<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>s and <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>eo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ganized societies, inspi<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ing <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>efo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>me<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>s and c<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>itics. Cultu<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>al p<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>og<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ess a<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ose as a<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>tists c<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>eated ext<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ao<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>dina<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>y wo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ks, while w<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ite<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>s sha<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ed pe<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>spectives <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>eflecting b<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>oade<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ealities. P<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>og<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ess, howeve<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>, <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>a<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ely a<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span><span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ived without <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>esistance o<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> cont<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ove<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>sy—st<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>uggles, e<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span><span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>o<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>s, and <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ecu<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span><span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ing ha<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>dships f<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>equently occu<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span><span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ed. Histo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>y's endu<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ing powe<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>emains in ou<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> pu<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>suit to <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>emembe<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>, inte<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>p<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>et, and lea<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>n f<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>om, ensu<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ing that <span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>eve<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>ence fo<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> the past endu<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>es as we c<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>eate ou<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span> own futu<span class="bold-r" style="font-weight: 900; background-color: #1e7e34; color: white; padding: 1px 2px; border-radius: 2px;">r</span>e.</div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="d-flex justify-content-between align-items-center border-top pt-3">
                        <div>
                            <a href="{% url 'phoneme_density:step2' matchup_id=matchup.id %}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Back to Step 2
                            </a>
                        </div>
                        <div>
                            {% if has_next_step %}
                                {% if next_step_accessible %}
                                    <a href="{% url 'phoneme_density:step4' matchup_id=matchup.id %}" class="btn btn-success">
                                        <i class="fas fa-arrow-right me-2"></i>Continue to Step 4
                                    </a>
                                {% else %}
                                    <button class="btn btn-outline-success" disabled title="Complete this step to continue">
                                        <i class="fas fa-lock me-2"></i>Step 4 (Locked)
                                    </button>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Keyboard shortcut for instructions (Alt+I)
document.addEventListener('keydown', function(e) {
    if (e.altKey && e.key === 'i') {
        e.preventDefault();
        // Toggle Bootstrap offcanvas
        const offcanvasElement = document.getElementById('instructionsOffcanvas');
        const offcanvas = bootstrap.Offcanvas.getOrCreateInstance(offcanvasElement);
        offcanvas.toggle();
    }
});

// Enhanced print functionality
function printPage() {
    // Set print-friendly title
    const originalTitle = document.title;
    document.title = 'Step3_RuleApplication_{{ ai_game.title|escapejs }}_Matchup{{ matchup.id }}';
    
    // Trigger print dialog
    window.print();
    
    // Restore original title
    setTimeout(() => {
        document.title = originalTitle;
    }, 1000);
}

// Keyboard shortcut for printing (Ctrl+P or Cmd+P)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
        e.preventDefault();
        printPage();
    }
});
</script>
{% endblock %}
